{"version":3,"file":"static/js/897.a3de94e3.chunk.js","mappings":"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","sources":["components/map/MapView.jsx"],"sourcesContent":["// src/components/map/MapView.jsx\r\n\r\nimport React, { useEffect, useRef, memo } from \"react\";\r\nimport {\r\n  MapContainer,\r\n  TileLayer,\r\n  Marker,\r\n  Popup,\r\n  Polyline,\r\n  useMap,\r\n} from \"react-leaflet\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet-polylinedecorator\";\r\n\r\nconst MAPTILER_KEY = \"F7plf6dqd6kpPsTlxyb6\";\r\n\r\n// --- Componentes y funciones de ayuda (sin cambios) ---\r\nconst CATEGORY_COLORS = {\r\n  turismo: \"#6E44FF\",\r\n  gastronomia: \"#E67E22\",\r\n  cultural: \"#9B59B6\",\r\n  transporte: \"#16A085\",\r\n  compras: \"#E84393\",\r\n  otros: \"#95A5A6\",\r\n  default: \"#6E44FF\",\r\n};\r\nconst iconCache = {};\r\nfunction getColoredIcon(category = \"default\") {\r\n  const lower = category.toLowerCase();\r\n  if (iconCache[lower]) return iconCache[lower];\r\n  const color = CATEGORY_COLORS[lower] || CATEGORY_COLORS.default;\r\n  const svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"36\" height=\"48\" viewBox=\"0 0 36 48\"><path d=\"M18 0C8.06 0 0 8.06 0 18c0 12.26 18 30 18 30s18-17.74 18-30C36 8.06 27.94 0 18 0z\" fill=\"${color}\" fill-opacity=\"0.9\"/><circle cx=\"18\" cy=\"18\" r=\"7\" fill=\"white\"/></svg>`;\r\n  const icon = L.icon({\r\n    iconUrl: \"data:image/svg+xml;base64,\" + btoa(svg),\r\n    iconSize: [36, 48],\r\n    iconAnchor: [18, 48],\r\n    popupAnchor: [0, -42],\r\n  });\r\n  iconCache[lower] = icon;\r\n  return icon;\r\n}\r\nfunction ChangeView({ center, zoom }) {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    if (center) map.flyTo(center, zoom, { animate: true, duration: 1 });\r\n  }, [center, zoom, map]);\r\n  return null;\r\n}\r\nconst formatDate = (d) =>\r\n  d\r\n    ? new Date(`${d}T00:00:00`).toLocaleDateString(\"es-ES\", {\r\n        day: \"numeric\",\r\n        month: \"short\",\r\n        year: \"numeric\",\r\n      })\r\n    : \"N/A\";\r\nconst RouteDecorator = ({ positions }) => {\r\n  const map = useMap();\r\n  useEffect(() => {\r\n    if (!map || positions.length < 2) return;\r\n    const polyline = L.polyline(positions);\r\n    const decorator = L.polylineDecorator(polyline, {\r\n      patterns: [\r\n        {\r\n          offset: \"15%\",\r\n          repeat: \"100px\",\r\n          symbol: L.Symbol.arrowHead({\r\n            pixelSize: 12,\r\n            pathOptions: {\r\n              fillOpacity: 1,\r\n              weight: 0,\r\n              fillColor: \"var(--color-primary)\",\r\n            },\r\n          }),\r\n        },\r\n      ],\r\n    }).addTo(map);\r\n    return () => {\r\n      map.removeLayer(decorator);\r\n    };\r\n  }, [map, positions]);\r\n  return null;\r\n};\r\n\r\n// ✅ ESTE ES EL NUEVO COMPONENTE \"INTELIGENTE\" QUE ARREGLA EL MAPA\r\nfunction MapResizer() {\r\n  const map = useMap();\r\n\r\n  useEffect(() => {\r\n    // --- Solución para la animación de Framer Motion ---\r\n    // Buscamos el contenedor principal de la página, que es el que Framer Motion anima.\r\n    const pageContainer = document.querySelector(\r\n      '.main-content > div[style*=\"transform\"]'\r\n    );\r\n\r\n    const handleAnimationEnd = () => {\r\n      console.log(\"Animation ended, resizing map.\");\r\n      map.invalidateSize();\r\n    };\r\n\r\n    if (pageContainer) {\r\n      // Escuchamos el evento que el navegador emite cuando una animación CSS termina.\r\n      pageContainer.addEventListener(\"animationend\", handleAnimationEnd);\r\n    }\r\n\r\n    // --- Solución para el cambio de tamaño del sidebar ---\r\n    const observer = new ResizeObserver(() => {\r\n      map.invalidateSize();\r\n    });\r\n    const mapLayout = document.querySelector(\".map-layout\");\r\n    if (mapLayout) {\r\n      observer.observe(mapLayout);\r\n    }\r\n\r\n    // Forzamos un redibujado inicial como seguro\r\n    setTimeout(() => map.invalidateSize(), 100);\r\n\r\n    // Limpieza al desmontar el componente\r\n    return () => {\r\n      if (pageContainer) {\r\n        pageContainer.removeEventListener(\"animationend\", handleAnimationEnd);\r\n      }\r\n      if (mapLayout) {\r\n        observer.unobserve(mapLayout);\r\n      }\r\n    };\r\n  }, [map]); // Se vuelve a ejecutar si la instancia del mapa cambia\r\n\r\n  return null;\r\n}\r\n\r\n// --- COMPONENTE PRINCIPAL DEL MAPA ---\r\nfunction MapView({ destinations, selectedCoords }) {\r\n  const positions = destinations\r\n    .filter((d) => d.lat && d.lng)\r\n    .map((d) => [d.lat, d.lng]);\r\n  const initialCenter = positions.length ? positions[0] : [20, 0];\r\n\r\n  return (\r\n    <div className=\"leaflet-wrapper\">\r\n      <MapContainer\r\n        center={initialCenter}\r\n        zoom={positions.length > 0 ? 5 : 2}\r\n        scrollWheelZoom\r\n        style={{ height: \"100%\", width: \"100%\", backgroundColor: \"#f0f0f0\" }}\r\n      >\r\n        <ChangeView center={selectedCoords} zoom={13} />\r\n        <TileLayer\r\n          url={`https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=${MAPTILER_KEY}`}\r\n          attribution='&copy; <a href=\"https://www.maptiler.com/\">MapTiler</a> &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n        />\r\n        {destinations.map(\r\n          (dest) =>\r\n            dest.lat &&\r\n            dest.lng && (\r\n              <Marker\r\n                key={dest.id}\r\n                position={[dest.lat, dest.lng]}\r\n                icon={getColoredIcon(dest.category || \"default\")}\r\n              >\r\n                <Popup>\r\n                  <div className=\"map-popup\">\r\n                    <h3>{`${dest.city}, ${dest.country}`}</h3>\r\n                    <p>\r\n                      <strong>Desde:</strong> {formatDate(dest.startDate)}\r\n                    </p>\r\n                    <p>\r\n                      <strong>Hasta:</strong> {formatDate(dest.endDate)}\r\n                    </p>\r\n                  </div>\r\n                </Popup>\r\n              </Marker>\r\n            )\r\n        )}\r\n        {positions.length > 1 && (\r\n          <Polyline\r\n            pathOptions={{\r\n              color: \"var(--color-primary)\",\r\n              weight: 4,\r\n              opacity: 0.9,\r\n            }}\r\n            positions={positions}\r\n          />\r\n        )}\r\n        {positions.length > 1 && <RouteDecorator positions={positions} />}\r\n\r\n        {/* Añadimos nuestro componente inteligente al mapa */}\r\n        <MapResizer />\r\n      </MapContainer>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default memo(MapView);\r\n"],"names":["CATEGORY_COLORS","turismo","gastronomia","cultural","transporte","compras","otros","default","iconCache","getColoredIcon","lower","arguments","length","undefined","toLowerCase","svg","concat","icon","L","iconUrl","btoa","iconSize","iconAnchor","popupAnchor","ChangeView","_ref","center","zoom","map","useMap","useEffect","flyTo","animate","duration","formatDate","d","Date","toLocaleDateString","day","month","year","RouteDecorator","_ref2","positions","polyline","decorator","patterns","offset","repeat","symbol","arrowHead","pixelSize","pathOptions","fillOpacity","weight","fillColor","addTo","removeLayer","MapResizer","pageContainer","document","querySelector","handleAnimationEnd","console","log","invalidateSize","addEventListener","observer","ResizeObserver","mapLayout","observe","setTimeout","removeEventListener","unobserve","MapView","_ref3","destinations","selectedCoords","filter","lat","lng","initialCenter","_jsx","className","children","_jsxs","MapContainer","scrollWheelZoom","style","height","width","backgroundColor","TileLayer","url","attribution","dest","Marker","position","category","Popup","city","country","startDate","endDate","id","Polyline","color","opacity","memo"],"sourceRoot":""}